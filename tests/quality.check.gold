--- After Joining table, check if any duplicates were introduced by the joion logic

select cst_id, count(*) from
(select
ci.cst_id,
ci.cst_key,
ci.cst_firstname,
ci.cst_lastname,
ci.cst_marital_status,
ci.cst_gndr,
ci.cst_create_date,
ca.BDATE,
ca.GEN,
la.CNTRY
From silver.crm_cust_info ci
Left join silver.erp_cust_az12 ca
on ci.cst_key=ca.CID
Left join silver.erp_loc_a101 la
on ci.cst_key=la.CID) t Group by cst_id having count(*)>1

----------------------------------------------
--Data Integration

select
ci.cst_gndr,
ca.GEN,
Case when ci.cst_gndr!='N/A' then ci.cst_gndr
	 else Coalesce(ca.GEN,'N/A')
ENd as New_gen
From silver.crm_cust_info ci
Left join silver.erp_cust_az12 ca
on ci.cst_key=ca.CID
Left join silver.erp_loc_a101 la
on ci.cst_key=la.CID
Order by 1,2

---------QA
Select * from gold.dim_customer

----------------
------------check uniqueness

select prd_key, count(*) from(
select
	prd_id,
	cat_id,
	prd_key,
	prd_nm,
	prd_cost,
	prd_line,
	prd_start_dt,
	pc.CAT,
	pc.SUB,
	pc.MAINTENANCE
from
silver.crm_prd_info pn
left join silver.erp_px_cat_g1v2 pc
on pn.cat_id=pc.ID
where prd_end_dt is null
)t group by prd_key having count(*) >1

----------------------------------

select * from gold.dim_products


------------

select * from gold.fact_sales


----------------------

--check if all dimension table can successfully join to the fact table

select *
from gold.fact_sales f
left join gold.dim_customer c
on c.customer_key=f.customer_key
left join gold.dim_products p
on p.product_key = f.product_key
where p.product_key  is null 
where c.customer_key is null






